(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/article/ticket/index"],{"2f73":function(t,e,n){"use strict";(function(t){n("2cc5");u(n("66fd"));var e=u(n("8e3c"));function u(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,n("543d")["createPage"])},3464:function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var u=l(n("007a")),i=l(n("7a1f")),o=l(n("f2b8")),s=n("fe8d");function l(t){return t&&t.__esModule?t:{default:t}}var a=function(){n.e("components/tabber/index").then(function(){return resolve(n("24b6"))}.bind(null,n)).catch(n.oe)},c={data:function(){return{form:{},user:{token:null,openid:null,userid:null},userTicket:{userid:null,full_name:null},ticketResults:{id:null,name:null,money:null,number:1,rwm_image:null,date:"2021-08-28T00:00:00+08:00",num:null,create_date:"2021-08-25T22:20:09.049429+08:00",change_date:"2021-08-25T22:20:09.049443+08:00",activity_key:null},contextResults:{id:null,name:null,context:null,money:null,images:null,user_name:null,dateday:null,browse:null,user_attend_num:null,start_date:"00/00/00 00:00",end_date:"00/00/00 00:00",amap:[{lnglat:{lng:116.319089,lat:39.942349},name:null,address:null,adname:null,cityname:null}]},out_trade_no:{pay:!1,show:!1,title:"成功",content:"已成功购票，后续请留意主页票务选项（后期增加）",confirm_text:"完成",count:1,next:null,previous:null,results:[{out_trade_no:"416f733ec23ea68c7ba635dd77fe20",status:1,trade_no:2,openid:"ovil75JE6yfeDfp6fqYa8rt67fQ4",prepay_id:"wx2522254915595197f40391dbd0ffe80000",name:"测试1",number:1,money:1,userid:2}]}}},onLoad:function(e){var n=this;u.default.commit("ticketUserId",null),u.default.commit("ticketUserFullName",null),u.default.commit("ticketListId",null),u.default.commit("ticketListName",null),t.setNavigationBarTitle({title:"票种信息"}),t.showLoading({title:"加载中",mask:!0}),this.contextResults.id=e.id,this.contextResults.name=e.title,console.log(e);var o=u.default.getters["getUser"];this.user.token=o.token,this.user.userid=o.userid,this.user.openid=o.openid,i.default.activity("GET",{},this.contextResults.id).then((function(t){n.contextResults=t,n.contextResults.start_date=(0,s.DateMat)(n.contextResults.start_date).format("yy/MM/dd hh:mm"),n.contextResults.end_date=(0,s.DateMat)(n.contextResults.end_date).format("yy/MM/dd hh:mm")})).catch((function(t){n.$refs.uTips.show({title:"接口错误:"+t.msg,type:"error",duration:"10000"})})).finally((function(){setTimeout((function(){t.hideLoading()}),100)}))},components:{"x-tabber":a},methods:{clickCellItem:function(e){console.log(e),this.ticketResults.number=1,0===e?(u.default.commit("ticketListId",null),u.default.commit("ticketListName",null),t.navigateTo({url:o.default.article_ticket_list({id:this.contextResults.id,title:this.contextResults.name})})):1===e&&(u.default.commit("ticketUserId",null),u.default.commit("ticketUserFullName",null),t.navigateTo({url:o.default.article_ticket_user_list({id:this.contextResults.id,title:this.contextResults.name})}))},datetime:function(t){return(0,s.DateMat)(t).format("yyyy/MM/dd hh:mm")},cancel:function(){this.out_trade_no.show=!1},sendForm:function(){var t=this;this.userTicket.userid&&this.ticketResults.id?i.default.payInfo("GET",{openid:this.user.openid,userid:this.user.userid,trade_no__activity_key:this.contextResults.id,status:0}).then((function(e){console.log("response",e.results.length),t.out_trade_no.results.length>0?(t.out_trade_no.title="已有成功购票记录",t.out_trade_no.content="您已成功购票，购买了 "+e.results.length+" 张门票",t.out_trade_no.confirm_text="继续"):t.out_trade_no.results.length<1&&t.WPay(),t.out_trade_no.show=!0})):(console.log("err"),this.$refs.uTips.show({title:"请选择票种或用户信息",type:"warning",duration:"2300"}))},WPay:function(){var e=this;console.log("支付"),this.out_trade_no.pay?(this.out_trade_no.pay=!1,t.navigateBack({delta:1,animationType:"pop-out",animationDuration:200})):this.user.openid?i.default.paymentPay("POST",{userid:this.user.userid,openid:this.user.openid,trade_no:this.ticketResults.id,activity_id:this.contextResults.id,money:this.ticketResults.money,name:this.ticketResults.name,number:this.ticketResults.number,user_ful:this.userTicket.userid}).then((function(n){console.log(n),t.requestPayment({provider:"wxpay",timeStamp:n.timeStamp,nonceStr:n.nonceStr,package:n.package,signType:n.signType,paySign:n.paySign,success:function(n){console.log("支付成功：",n),e.out_trade_no.title="成功",e.out_trade_no.content="已成功购票，后续请留意主页票务选项（后期增加）",e.out_trade_no.confirm_text="完成",e.out_trade_no.show=!0,e.out_trade_no.pay=!0,t.showToast({title:"支付成功"})},fail:function(t){console.log("支付失败：",t),e.$refs.uTips.show({title:"支付失败",type:"error",duration:"30000"})}})})):(console.log("未登录"),this.$refs.uTips.show({title:"请登录",type:"warning",duration:"2300"}))}},computed:{ticketUser:function(){return u.default.getters["getTicketUserID"]},ticketList:function(){return u.default.getters["getTicketListID"]}},watch:{ticketUser:function(t){console.log("获取活动购票选择的用户信息",t,e);var e=u.default.getters["getTicketUserFullName"];this.userTicket.userid=t,this.userTicket.full_name=e,console.log("获取活动购票选择的用户信息",this.userTicket,t,e)},ticketList:function(e){var n=this,o=u.default.getters["getTicketListName"];console.log("获取活动购票选择的用户信息",o),this.ticketResults.id=e,this.ticketResults.name=o,t.showLoading({title:"加载中",mask:!0}),i.default.activityTicket("GET",{},this.ticketResults.id).then((function(t){n.ticketResults.id=t.id,n.ticketResults.name=t.name,n.ticketResults.money=t.money,n.ticketResults.rwm_image=t.rwm_image,n.ticketResults.date=t.date,n.ticketResults.num=t.num,n.ticketResults.create_date=t.create_date,n.ticketResults.change_date=t.change_date,n.ticketResults.activity_key=t.activity_key,console.log("ticketResults",t)})).catch((function(t){n.$refs.uTips.show({title:"接口错误:"+t.msg,type:"error",duration:"10000"})})).finally((function(){setTimeout((function(){t.hideLoading()}),100)})),console.log("获取活动购票选择的用户信息",this.userTicket,e,o)}}};e.default=c}).call(this,n("543d")["default"])},"5dcb":function(t,e,n){"use strict";n.r(e);var u=n("3464"),i=n.n(u);for(var o in u)"default"!==o&&function(t){n.d(e,t,(function(){return u[t]}))}(o);e["default"]=i.a},"8e3c":function(t,e,n){"use strict";n.r(e);var u=n("a24f"),i=n("5dcb");for(var o in i)"default"!==o&&function(t){n.d(e,t,(function(){return i[t]}))}(o);n("b4a9");var s,l=n("f0c5"),a=Object(l["a"])(i["default"],u["b"],u["c"],!1,null,null,null,!1,u["a"],s);e["default"]=a.exports},"90c1":function(t,e,n){},a24f:function(t,e,n){"use strict";n.d(e,"b",(function(){return i})),n.d(e,"c",(function(){return o})),n.d(e,"a",(function(){return u}));var u={uTopTips:function(){return n.e("node-modules/uview-ui/components/u-top-tips/u-top-tips").then(n.bind(null,"5daa"))},uCard:function(){return n.e("node-modules/uview-ui/components/u-card/u-card").then(n.bind(null,"c847"))},uIcon:function(){return n.e("node-modules/uview-ui/components/u-icon/u-icon").then(n.bind(null,"5bde"))},uCellGroup:function(){return n.e("node-modules/uview-ui/components/u-cell-group/u-cell-group").then(n.bind(null,"881b"))},uCellItem:function(){return n.e("node-modules/uview-ui/components/u-cell-item/u-cell-item").then(n.bind(null,"e9d4"))},uNumberBox:function(){return n.e("node-modules/uview-ui/components/u-number-box/u-number-box").then(n.bind(null,"0c26"))},uModal:function(){return n.e("node-modules/uview-ui/components/u-modal/u-modal").then(n.bind(null,"1d32"))}},i=function(){var t=this,e=t.$createElement,n=(t._self._c,t.ticketResults.name?t.datetime(t.ticketResults.date):null);t.$mp.data=Object.assign({},{$root:{m0:n}})},o=[]},b4a9:function(t,e,n){"use strict";var u=n("90c1"),i=n.n(u);i.a}},[["2f73","common/runtime","common/vendor"]]]);