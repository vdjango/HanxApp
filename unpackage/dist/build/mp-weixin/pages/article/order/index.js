(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/article/order/index"],{"14a9":function(e,n,t){"use strict";var o=t("70f5"),i=t.n(o);i.a},2030:function(e,n,t){"use strict";(function(e){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var o=u(t("007a")),i=u(t("7a1f"));u(t("f2b8"));function u(e){return e&&e.__esModule?e:{default:e}}var r=function(){t.e("components/tabber/index").then(function(){return resolve(t("24b6"))}.bind(null,t)).catch(t.oe)},s={data:function(){return{articleContext:{},contextResults:{results:[]},out_trade_no:{title:"成功",content:"已成功购票，后续请留意主页票务选项（后期增加）",confirm_text:"完成",count:1,next:null,previous:null,results:[{out_trade_no:"416f733ec23ea68c7ba635dd77fe20",status:1,trade_no:2,openid:"ovil75JE6yfeDfp6fqYa8rt67fQ4",prepay_id:"wx2522254915595197f40391dbd0ffe80000",name:"测试1",number:1,money:1,userid:2}]},election:0,loading:!0,specSelected:{number:1,data:{id:null,money:0}},UserInfo:{login:!1,avatarUrl:"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIVUHJYDoYklJFAIIdmiaQIrfXhSHXUzW9n6Ll06brS7m0xU9FYc8A9ibbCickaicics5mUHvAAWib9iabibQ/132",city:"门头沟",country:"中国",gender:1,language:"zh_CN",nickName:"君思",province:"北京"},user:{token:null,userid:null,openid:null},userInfoText:{loading:!1,full_name:null,certificates_no:null,mobile:null},rules:{full_name:[{required:!0,message:"请输入姓名",trigger:["change","blur"]}],certificates_no:[{required:!0,message:"请输入身份证号",trigger:["change","blur"]}],mobile:[{required:!0,message:"请输入手机号",trigger:["change","blur"]}]},pay_:!1,pay_cancel:!0,pay_title:"支付",pay_confirm_text:"付款",pay_context:"已成功购票，后续请留意主页票务选项（后期增加）",pay_success:!1}},onLoad:function(n){var t=this;e.hideShareMenu();var u=n.id,r=n.title;this.articleContext.id=u,this.articleContext.title=r,e.setNavigationBarTitle({title:"票种"}),i.default.activityTicket("GET",{activity_key:u},null).then((function(e){t.contextResults=e,console.log("response",e),t.contextResults.results&&(t.specSelected.data=t.contextResults.results[0]),setTimeout((function(){t.loading=!1}),300)}));var s=o.default.getters["getUser"];this.user.token=s.token,this.user.userid=s.userid,this.user.openid=s.openid,this.UserInfo.login=s.login,this.UserInfo.avatarUrl=s.avatarUrl,this.UserInfo.city=s.city,this.UserInfo.country=s.country,this.UserInfo.gender=s.gender,this.UserInfo.language=s.language,this.UserInfo.nickName=s.nickName,this.UserInfo.province=s.province,i.default.userInfo("GET",{user:this.user.userid}).then((function(e){console.log("验证通过",e),e.results.length<1?(t.$refs.uTips.show({title:"warning",type:"success",duration:"5000"}),setTimeout((function(){t.userInfoText.loading=!0}),100)):(t.$refs.uTips.show({title:"获取用户信息成功",type:"success",duration:"2300"}),i.default.payInfo("GET",{openid:t.user.openid,userid:t.user.userid,trade_no__activity_key:t.articleContext.id,status:0}).then((function(e){if(t.out_trade_no=e,t.out_trade_no.title="成功",t.out_trade_no.content="已成功购票，后续请留意主页票务选项（后期增加）",t.out_trade_no.confirm_text="完成",t.out_trade_no.count=e.count,t.out_trade_no.next=e.next,t.out_trade_no.previous=e.previous,t.out_trade_no.results=e.results,setTimeout((function(){t.loading=!1}),100),console.log("response",t.out_trade_no.results.length),t.out_trade_no.results.length>0){var n=0;for(var o in t.out_trade_no.results)n+=t.out_trade_no.results[o].number;t.out_trade_no.title="已有成功购票记录",t.out_trade_no.content="您已成功购票，购买了 "+n+" 张门票",t.out_trade_no.confirm_text="继续",t.pay_success=!0}})))})).catch((function(){t.$refs.uTips.show({title:"获取用户信息成功",type:"error",duration:"5000"})})).finally((function(){}))},onReady:function(){this.$refs.uForm.setRules(this.rules)},components:{"x-tabber":r},computed:{},methods:{ticketElection:function(e,n){this.election=e,this.specSelected.data=n,console.log(e,n)},numberChange:function(e){this.specSelected.number=e.number},confirm:function(){this.pay_=!0,this.pay_context="票种："+this.specSelected.data.name+"<br> 数量："+this.specSelected.number+"张<br> 价格："+this.money_tole(this.specSelected.data.money)*this.specSelected.number+"元"},confirmUserInfo:function(){var n=this;this.$refs.uForm.validate((function(t){t?(e.showLoading({title:"加载中"}),i.default.userInfo("POST",{user:n.user.userid,full_name:n.userInfoText.full_name,certificates_no:n.userInfoText.certificates_no,mobile:n.userInfoText.mobile}).then((function(e){console.log("验证通过"),n.$refs.uTips.show({title:"用户信息添加成功",type:"success",duration:"2300"})})).catch((function(){n.$refs.uTips.show({title:"用户信息添加失败，请不要购票。",type:"error",duration:"5000"})})).finally((function(){setTimeout((function(){n.userInfoText.loading=!1,n.$refs.uModalUserInfo.clearLoading(),e.hideLoading()}),100)}))):(console.log("验证失败"),n.$refs.uModalUserInfo.clearLoading())}))},pay_confirm:function(){"继续"!=this.out_trade_no.confirm_text&&e.navigateBack({delta:1,animationType:"pop-out",animationDuration:200})},WPay:function(){var n=this;console.log("支付"),this.out_trade_no.title="成功",this.out_trade_no.content="已成功购票，后续请留意主页票务选项（后期增加）",this.out_trade_no.confirm_text="完成",this.user.openid?i.default.paymentPay("POST",{userid:this.user.userid,openid:this.user.openid,trade_no:this.specSelected.data.id,activity_id:this.articleContext.id,money:this.specSelected.data.money,name:this.specSelected.data.name,number:this.specSelected.number}).then((function(t){console.log(t),e.requestPayment({provider:"wxpay",timeStamp:t.timeStamp,nonceStr:t.nonceStr,package:t.package,signType:t.signType,paySign:t.paySign,success:function(t){n.pay_success=!0,console.log("支付成功：",t),e.showToast({title:"支付成功"})},fail:function(e){console.log("支付失败：",e),this.$refs.uTips.show({title:"支付失败: "+e,type:"error",duration:"30000"})}})})):(console.log("未登录"),this.$refs.uTips.show({title:"请登录",type:"warning",duration:"2300"}))},getUserInfo:function(n){var t=this;e.getUserProfile({lang:"zh_CN",desc:"需要登陆哦",withCredentials:!0,success:function(n){e.showLoading({title:"登陆中"}),t.UserInfo.avatarUrl=n.userInfo.avatarUrl,t.UserInfo.city=n.userInfo.city,t.UserInfo.country=n.userInfo.country,t.UserInfo.gender=n.userInfo.gender,t.UserInfo.language=n.userInfo.language,t.UserInfo.nickName=n.userInfo.nickName,t.UserInfo.province=n.userInfo.province,t.getOpenId(t.UserInfo)},fail:function(e){console.log("getUserInfo.fail"),console.log(e)}})},getOpenId:function(n){var t=this;e.login({provider:"weixin",success:function(u){i.default.wechatAuthCode2("POST",{code:u.code,res:n}).then((function(n){console.log("wechatAuthCode2",n),console.log("wechatAuthCode2",n,u),t.user.code=u.code,t.user.userid=n.userid,t.user.openid=n.openid,t.UserInfo.login=!0,o.default.commit("login",{token:null,userid:t.user.userid,openid:t.user.openid,login:t.UserInfo.login,avatarUrl:t.UserInfo.avatarUrl,city:t.UserInfo.city,country:t.UserInfo.country,gender:t.UserInfo.gender,language:t.UserInfo.language,nickName:t.UserInfo.nickName,province:t.UserInfo.province}),e.showToast({title:"登陆成功"})})).catch((function(){t.$refs.uTips.show({title:"接口错误.request",type:"error",duration:"2300"})})).finally((function(){setTimeout((function(){e.hideLoading()}),100)}))}})},money_tole:function(e){return parseInt(e)/100}}};n.default=s}).call(this,t("543d")["default"])},"69f9":function(e,n,t){"use strict";t.r(n);var o=t("2030"),i=t.n(o);for(var u in o)"default"!==u&&function(e){t.d(n,e,(function(){return o[e]}))}(u);n["default"]=i.a},"70f5":function(e,n,t){},"85fb":function(e,n,t){"use strict";(function(e){t("2cc5");o(t("66fd"));var n=o(t("f75f"));function o(e){return e&&e.__esModule?e:{default:e}}e(n.default)}).call(this,t("543d")["createPage"])},e457:function(e,n,t){"use strict";t.d(n,"b",(function(){return i})),t.d(n,"c",(function(){return u})),t.d(n,"a",(function(){return o}));var o={uTopTips:function(){return t.e("node-modules/uview-ui/components/u-top-tips/u-top-tips").then(t.bind(null,"5daa"))},uCard:function(){return t.e("node-modules/uview-ui/components/u-card/u-card").then(t.bind(null,"c847"))},uIcon:function(){return t.e("node-modules/uview-ui/components/u-icon/u-icon").then(t.bind(null,"5bde"))},uNumberBox:function(){return t.e("node-modules/uview-ui/components/u-number-box/u-number-box").then(t.bind(null,"0c26"))},uModal:function(){return t.e("node-modules/uview-ui/components/u-modal/u-modal").then(t.bind(null,"1d32"))},uForm:function(){return t.e("node-modules/uview-ui/components/u-form/u-form").then(t.bind(null,"ea8b"))},uFormItem:function(){return Promise.all([t.e("common/vendor"),t.e("node-modules/uview-ui/components/u-form-item/u-form-item")]).then(t.bind(null,"a64a"))},uInput:function(){return Promise.all([t.e("common/vendor"),t.e("node-modules/uview-ui/components/u-input/u-input")]).then(t.bind(null,"d407"))},uSkeleton:function(){return t.e("node-modules/uview-ui/components/u-skeleton/u-skeleton").then(t.bind(null,"d1c3"))}},i=function(){var e=this,n=e.$createElement,t=(e._self._c,e.loading?null:e.__map(e.contextResults.results,(function(n,t){var o=e.__get_orig(n),i=e.money_tole(n.money);return{$orig:o,m0:i}})));e.$mp.data=Object.assign({},{$root:{l0:t}})},u=[]},f75f:function(e,n,t){"use strict";t.r(n);var o=t("e457"),i=t("69f9");for(var u in i)"default"!==u&&function(e){t.d(n,e,(function(){return i[e]}))}(u);t("14a9");var r,s=t("f0c5"),a=Object(s["a"])(i["default"],o["b"],o["c"],!1,null,null,null,!1,o["a"],r);n["default"]=a.exports}},[["85fb","common/runtime","common/vendor"]]]);